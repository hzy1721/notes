import{_ as s,c as a,o as n,d as l}from"./app.c431fedc.js";const A=JSON.parse('{"title":"拖拽事件","description":"","frontmatter":{},"headers":[{"level":2,"title":"什么是拖拽 (Drag and Drop)","slug":"什么是拖拽-drag-and-drop","link":"#什么是拖拽-drag-and-drop","children":[]},{"level":2,"title":"draggable 属性","slug":"draggable-属性","link":"#draggable-属性","children":[]},{"level":2,"title":"拖拽事件 (DragEvent)","slug":"拖拽事件-dragevent","link":"#拖拽事件-dragevent","children":[]},{"level":2,"title":"自定义拖拽图片","slug":"自定义拖拽图片","link":"#自定义拖拽图片","children":[]},{"level":2,"title":"设置和读取拖拽数据","slug":"设置和读取拖拽数据","link":"#设置和读取拖拽数据","children":[]},{"level":2,"title":"设置拖拽类型","slug":"设置拖拽类型","link":"#设置拖拽类型","children":[]},{"level":2,"title":"droppable 与成功拖拽","slug":"droppable-与成功拖拽","link":"#droppable-与成功拖拽","children":[]},{"level":2,"title":"Example","slug":"example","link":"#example","children":[]}],"relativePath":"fe/browser/drag.md"}'),e={name:"fe/browser/drag.md"},o=l(`<h1 id="拖拽事件" tabindex="-1">拖拽事件 <a class="header-anchor" href="#拖拽事件" aria-hidden="true">#</a></h1><p>这篇文章主要阐述了 HTML 原生拖拽 API 的基本使用方法以及相关的核心概念。</p><h2 id="什么是拖拽-drag-and-drop" tabindex="-1">什么是拖拽 (Drag and Drop) <a class="header-anchor" href="#什么是拖拽-drag-and-drop" aria-hidden="true">#</a></h2><p>拖拽是指用鼠标点击一个<strong>可拖拽 (draggable)</strong> 的元素，不松开鼠标并移动光标到另一个<strong>可放置 (droppable)</strong> 的元素位置，最后松开鼠标完成拖拽。</p><p>HTML 通过提供多种<strong>拖拽事件 (DragEvent)</strong> 来让开发者自定义拖拽的过程，并通过 <code>DataTransfer</code> 对象实现拖拽数据的传递。</p><h2 id="draggable-属性" tabindex="-1">draggable 属性 <a class="header-anchor" href="#draggable-属性" aria-hidden="true">#</a></h2><p><a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Global_attributes/draggable" target="_blank" rel="noreferrer">draggable</a> 属性是一个枚举值，有三种取值：</p><ul><li><code>auto</code>：默认，只有被选中的文本、图片、链接可以拖拽</li><li><code>true</code>：元素可以拖拽</li><li><code>false</code>：元素禁止拖拽</li></ul><h2 id="拖拽事件-dragevent" tabindex="-1">拖拽事件 (DragEvent) <a class="header-anchor" href="#拖拽事件-dragevent" aria-hidden="true">#</a></h2><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/DragEvent" target="_blank" rel="noreferrer">DragEvent</a> 继承自 MouseEvent，有一个只读属性 <code>dataTransfer</code>，类型是 <a href="https://developer.mozilla.org/en-US/docs/Web/API/DataTransfer" target="_blank" rel="noreferrer">DataTransfer</a>。</p><p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5c37d49f92e34f1f9a801a257e0b7135~tplv-k3u1fbpfcp-watermark.image?" alt="截屏2022-07-26 13.15.32.png"></p><p>根据拖拽事件触发的位置不同，可以分为两类：</p><ul><li>起始元素 <ul><li><code>dragstart</code>：开始拖拽时触发</li><li><code>dragend</code>：拖拽结束时触发 (拖拽成功或失败都会触发)</li><li><code>drag</code>：拖拽过程中低频率触发 (每隔几百 ms)</li></ul></li><li>目标元素 <ul><li><code>dragenter</code>：进入元素时触发</li><li><code>dragover</code>：悬停在元素上时高频率触发 <ul><li>鼠标不动时每隔 50ms 触发一次，慢速移动 5ms，快速移动 1ms</li></ul></li><li><code>dragleave</code>：离开元素时触发</li><li><code>drop</code>：拖拽成功时触发</li></ul></li></ul><h2 id="自定义拖拽图片" tabindex="-1">自定义拖拽图片 <a class="header-anchor" href="#自定义拖拽图片" aria-hidden="true">#</a></h2><p>默认在拖拽过程中会有一张元素的半透明图片跟随光标，我们也可以在 <code>dragstart</code> 处理函数中使用 <a href="https://developer.mozilla.org/en-US/docs/Web/API/DataTransfer/setDragImage" target="_blank" rel="noreferrer">setDragImage</a> 自定义显示的图片，支持 <code>Image</code> 元素和页面上已有的其他元素。</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">dragSource</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">addEventListener</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">dragstart</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">e</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">img</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">Image</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// 100x100的图片</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">img</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">src</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">https://via.placeholder.com/100</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// 光标在(30,30)位置</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">e</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">dataTransfer</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setDragImage</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">img</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">30</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">30</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">dragSource</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">addEventListener</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">dragstart</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">e</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">el</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">document</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getElementById</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">another-element</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">e</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">dataTransfer</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setDragImage</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">el</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">10</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">10</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><h2 id="设置和读取拖拽数据" tabindex="-1">设置和读取拖拽数据 <a class="header-anchor" href="#设置和读取拖拽数据" aria-hidden="true">#</a></h2><p>使用 <a href="https://developer.mozilla.org/en-US/docs/Web/API/DataTransfer/setData" target="_blank" rel="noreferrer">setData</a> 和 <a href="https://developer.mozilla.org/en-US/docs/Web/API/DataTransfer/getData" target="_blank" rel="noreferrer">getData</a> 进行拖拽数据的读写。</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">dragSource</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">addEventListener</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">dragstart</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">e</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">e</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">dataTransfer</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setData</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">text/plain</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">e</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">target</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">id</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">dropArea</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">addEventListener</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">drop</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">e</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">id</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">e</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">dataTransfer</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getData</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">text/plain</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">el</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">document</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getElementById</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">id</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">e</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">target</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">appendChild</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">el</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><h2 id="设置拖拽类型" tabindex="-1">设置拖拽类型 <a class="header-anchor" href="#设置拖拽类型" aria-hidden="true">#</a></h2><p>使用 <a href="https://developer.mozilla.org/en-US/docs/Web/API/DataTransfer/dropEffect" target="_blank" rel="noreferrer">dropEffect</a> 设置的拖拽类型有 4 种：</p><ul><li><code>copy</code>：复制</li><li><code>move</code>：移动</li><li><code>link</code>：建立链接</li><li><code>none</code>：不可放置</li></ul><p>不同的拖拽类型会显示不同的图标，<code>copy</code> 是一个加号，<code>move</code> 没有图标，<code>link</code> 是一个弧形箭头。设置为 <code>none</code> 会使拖拽无法成功 (无法触发 <code>drop</code> 事件，而是会触发 <code>dragleave</code> 和 <code>dragend</code>)。</p><p>触发 <code>dragenter</code> 和 <code>dragover</code> 事件时，浏览器会初始化 <code>dropEffect</code> 的值，同时用户可以按下 Cmd/Alt 键切换拖拽类型。开发者也可以在这两个事件的处理函数中手动设置 <code>dropEffect</code> 的值。</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">dropArea</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">addEventListener</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">dragover</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">e</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">e</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">dataTransfer</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">dropEffect</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">move</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">e</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">preventDefault</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><h2 id="droppable-与成功拖拽" tabindex="-1">droppable 与成功拖拽 <a class="header-anchor" href="#droppable-与成功拖拽" aria-hidden="true">#</a></h2><p><strong>并没有</strong>一个属性叫 droppable，浏览器默认禁止放置在大部分元素上，需要同时指定 <code>dragover</code> 和 <code>drop</code> 的处理函数才能让一个元素成为 <em>droppable</em>。</p><p>一次成功的拖拽需要满足以下要求：</p><ul><li><code>dropEffect</code> 不能设置为 <code>none</code></li><li>在松开鼠标前的最后一个 <code>dragenter</code> 或 <code>dragover</code> 事件的处理函数中调用了 <code>preventDefault</code><ul><li>两个处理函数中均调用即可</li></ul></li></ul><p>拖拽成功后依次触发 <code>drop</code> 和 <code>dragend</code> 事件。</p><h2 id="example" tabindex="-1">Example <a class="header-anchor" href="#example" aria-hidden="true">#</a></h2><p><a href="https://code.juejin.cn/pen/7124288893750345765" target="_blank" rel="noreferrer">代码片段</a></p>`,33),p=[o];function r(t,c,D,d,F,y){return n(),a("div",null,p)}const C=s(e,[["render",r]]);export{A as __pageData,C as default};

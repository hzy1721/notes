import{_ as s,c as i,o as a,a1 as e}from"./chunks/framework.mNpZ2GHZ.js";const c=JSON.parse('{"title":"拖拽事件","description":"","frontmatter":{},"headers":[],"relativePath":"fe/browser/drag.md","filePath":"fe/browser/drag.md","lastUpdated":1683687303000}'),n={name:"fe/browser/drag.md"},l=e(`<h1 id="拖拽事件" tabindex="-1">拖拽事件 <a class="header-anchor" href="#拖拽事件" aria-label="Permalink to &quot;拖拽事件&quot;">​</a></h1><p>这篇文章主要阐述了 HTML 原生拖拽 API 的基本使用方法以及相关的核心概念。</p><h2 id="什么是拖拽" tabindex="-1">什么是拖拽 <a class="header-anchor" href="#什么是拖拽" aria-label="Permalink to &quot;什么是拖拽&quot;">​</a></h2><p>拖拽 (Drag and Drop) 是指用鼠标点击一个<strong>可拖拽 (draggable)</strong> 的元素，不松开鼠标并移动光标到另一个<strong>可放置 (droppable)</strong> 的元素位置，最后松开鼠标完成拖拽。</p><p>HTML 通过提供多种<strong>拖拽事件 (DragEvent)</strong> 来让开发者自定义拖拽的过程，并通过 <code>DataTransfer</code> 对象实现拖拽数据的传递。</p><h2 id="draggable" tabindex="-1">draggable <a class="header-anchor" href="#draggable" aria-label="Permalink to &quot;draggable&quot;">​</a></h2><p><code>draggable</code> 有 3 种取值：</p><ul><li><code>auto</code>：默认，只有被选中的文本、图片、链接可以拖拽</li><li><code>true</code>：元素可以拖拽</li><li><code>false</code>：元素禁止拖拽</li></ul><h2 id="dragevent" tabindex="-1">DragEvent <a class="header-anchor" href="#dragevent" aria-label="Permalink to &quot;DragEvent&quot;">​</a></h2><p><code>DragEvent</code> 继承自 <code>MouseEvent</code>，有一个只读属性 <code>dataTransfer</code>，类型是 <code>DataTransfer</code>。</p><p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5c37d49f92e34f1f9a801a257e0b7135~tplv-k3u1fbpfcp-watermark.image?" alt="截屏2022-07-26 13.15.32.png"></p><p>根据触发位置不同，拖拽事件可以分为两类：</p><ul><li>起始元素 <ul><li><code>dragstart</code>：开始拖拽</li><li><code>dragend</code>：拖拽结束 (拖拽成功或失败都会触发)</li><li><code>drag</code>：拖拽过程中低频率触发 (每隔几百 ms)</li></ul></li><li>目标元素 <ul><li><code>dragenter</code>：进入元素时触发</li><li><code>dragover</code>：悬停在元素上时高频率触发 <ul><li>鼠标不动时每隔 50ms 触发一次，慢速移动 5ms，快速移动 1ms</li></ul></li><li><code>dragleave</code>：离开元素时触发</li><li><code>drop</code>：拖拽成功时触发</li></ul></li></ul><h2 id="自定义拖拽图片" tabindex="-1">自定义拖拽图片 <a class="header-anchor" href="#自定义拖拽图片" aria-label="Permalink to &quot;自定义拖拽图片&quot;">​</a></h2><p>默认在拖拽过程中会有一张元素的半透明图片跟随光标，也可以在 <code>dragstart</code> 处理函数中使用 <code>setDragImage</code> 自定义显示的图片，支持 <code>Image</code> 元素和页面上已有的其他元素。</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">dragSource.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">addEventListener</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;dragstart&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> img</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Image</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 100x100的图片</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  img.src </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;https://via.placeholder.com/100&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 光标在(30,30)位置</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  e.dataTransfer.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setDragImage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(img, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">30</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">30</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre></div><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">dragSource.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">addEventListener</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;dragstart&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> el</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> document.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getElementById</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;another-element&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  e.dataTransfer.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setDragImage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(el, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre></div><h2 id="设置和读取拖拽数据" tabindex="-1">设置和读取拖拽数据 <a class="header-anchor" href="#设置和读取拖拽数据" aria-label="Permalink to &quot;设置和读取拖拽数据&quot;">​</a></h2><p>使用 <code>setData</code> 和 <code>getData</code> 进行拖拽数据的读写。</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">dragSource.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">addEventListener</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;dragstart&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  e.dataTransfer.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setData</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;text/plain&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, e.target.id);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">dropArea.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">addEventListener</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;drop&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> e.dataTransfer.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getData</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;text/plain&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> el</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> document.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getElementById</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(id);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  e.target.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">appendChild</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(el);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre></div><h2 id="设置拖拽类型" tabindex="-1">设置拖拽类型 <a class="header-anchor" href="#设置拖拽类型" aria-label="Permalink to &quot;设置拖拽类型&quot;">​</a></h2><p>使用 <code>dropEffect</code> 设置的拖拽类型有 4 种：</p><ul><li><code>copy</code>：复制 <ul><li>图标：加号</li></ul></li><li><code>move</code>：移动 <ul><li>无图标</li></ul></li><li><code>link</code>：建立链接 <ul><li>图标：弧形箭头</li></ul></li><li><code>none</code>：不可放置 <ul><li>会使拖拽无法成功 (无法触发 <code>drop</code> 事件，而是会触发 <code>dragleave</code> 和 <code>dragend</code>)</li></ul></li></ul><p>触发 <code>dragenter</code> 和 <code>dragover</code> 事件时，浏览器会初始化 <code>dropEffect</code> 的值，用户也可以按下 Cmd/Alt 键切换拖拽类型。</p><p>开发者可以在这两个事件的处理函数中手动设置 <code>dropEffect</code> 的值。</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">dropArea.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">addEventListener</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;dragover&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  e.dataTransfer.dropEffect </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;move&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  e.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">preventDefault</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre></div><h2 id="成功拖拽" tabindex="-1">成功拖拽 <a class="header-anchor" href="#成功拖拽" aria-label="Permalink to &quot;成功拖拽&quot;">​</a></h2><p>浏览器默认禁止放置在大部分元素上，需要同时指定 <code>dragover</code> 和 <code>drop</code> 的处理函数才能允许一个元素成为拖拽的目的地。</p><p>一次成功的拖拽需要满足以下要求：</p><ul><li><code>dropEffect</code> 不能设置为 <code>none</code></li><li>在松开鼠标前的最后一个 <code>dragenter</code> 或 <code>dragover</code> 事件的处理函数中调用了 <code>preventDefault</code><ul><li>两个处理函数中均调用即可</li></ul></li></ul><p>拖拽成功后依次触发 <code>drop</code> 和 <code>dragend</code> 事件。</p><h2 id="demo-码上掘金" tabindex="-1">Demo (码上掘金) <a class="header-anchor" href="#demo-码上掘金" aria-label="Permalink to &quot;Demo (码上掘金)&quot;">​</a></h2><p><a href="https://code.juejin.cn/pen/7124288893750345765" target="_blank" rel="noreferrer">代码片段</a></p>`,33),t=[l];function h(p,d,k,r,E,o){return a(),i("div",null,t)}const y=s(n,[["render",h]]);export{c as __pageData,y as default};

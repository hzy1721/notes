# useDeferredValue

推迟更新部分 UI。

```js
const deferredValue = useDeferredValue(value);
```

参数：

- `value`：想要推迟更新的值

返回值：

- `deferredValue`：
  - 第一次渲染：与 `value` 相同
  - 后续渲染：先返回旧值渲染一次，如果值有变化，则在后台返回新值渲染一次

后台渲染：

- 首先尝试渲染，如果阻塞了就放弃这次渲染，直到数据准备好之后再渲染
- 后台渲染是可中断的，如果渲染过程中值又发生变化，则从头开始渲染 (类似于防抖)
- 后台渲染不会触发 `<Suspense>`，如果渲染阻塞了 UI，将会显示旧值的渲染结果

警告：

- 不要传入每次渲染都不相同的值，会导致不必要的后台渲染，比如组件内的对象、函数
- 使用 `deferredValue` 的组件必须用 `memo` 缓存，否则返回旧值也会导致组件渲染

用途：

- 在新 UI 渲染好之前显示旧 UI
  - 可以通过比较 `value` 和 `deferredValue` 是否相同来判断是新 UI 还是旧 UI
- 昂贵组件的性能优化，降低渲染频率

与防抖节流的区别：

| useDeferredValue                       | 防抖节流                                           |
| -------------------------------------- | -------------------------------------------------- |
| 更适合优化 React 组件渲染              | 通用的降低执行频率的方法                           |
| 没有固定的时间间隔，不同设备的表现不同 | 有指定的时间间隔阈值                               |
| 提供了后台渲染的能力，不会阻塞 UI      | 只是推迟更新或降低更新频率，每次更新仍可能造成卡顿 |

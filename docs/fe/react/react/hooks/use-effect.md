# useEffect

将组件与外部系统进行同步。

```js
useEffect(setup, dependencies?)
```

- setup
  - 第一个参数传入
  - 触发副作用，比如修改 DOM、建立订阅
  - 在组件第一次挂载和每次更新时执行
- cleanup
  - setup 函数的返回值
  - 清除副作用，比如取消订阅、取消定时器
  - 在每次更新和组件卸载时执行
  - 更新时先执行 cleanup，后重新执行 setup
- dependencies
  - 依赖数组，只有依赖变化时才重新执行
  - 依赖必须是响应式数据，也就是修改后会触发重新渲染的数据
    - prop、state、context 以及组件内依赖这些数据的值
  - 非响应式数据不能作为依赖，React 不追踪这些数据的更新，修改他们不会触发重新渲染
    - `ref.current`、`location.pathname` 等
  - 依赖列表必须包含 effect 用到的所有响应式数据，开发者没有选择的余地
  - 如果依赖列表不符合预期，则首先修改 effect 代码逻辑，然后更新列表
    - 依赖只是逻辑的反映，不能凭空修改依赖列表
  - 对于在 effect 内更新状态用到了旧状态的情况，完全没必要将旧状态作为依赖，而是向 `setState` 传入更新函数，通过函数参数获取旧状态
  - 由于每次创建的对象和函数都不相同，因此要避免使用组件内的对象和函数作为依赖，应该将对象和函数移到组件外或 effect 内

## event handler

- event handler
  - 事件发生时手动执行
  - 可能用到响应式数据，但是数据更新时不会重新执行
- effect
  - 响应式依赖变化时自动重新执行
